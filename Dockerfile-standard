# Stage 1: Build the Go binary using Go 1.20.5 on Alpine
FROM golang:1.20.5-alpine AS builder

# Set the working directory
WORKDIR /app

# Copy the Go source code
COPY ./src/main.go .

# Build the binary (statically linked for minimal dependencies)
RUN go build -o demoguard main.go

# Stage 2: Create a minimal runtime image using plain Alpine
FROM alpine:3.20

# Copy the built binary from the builder stage
COPY --from=builder /app/demoguard /demoguard

# Run the binary as the entrypoint
CMD ["/demoguard"]